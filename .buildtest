#!/bin/bash
# Quick Build Test Script
# Tests webpack configuration without full build

echo "ğŸ” Testing webpack configuration..."

# Check if polyfills exist
echo "ğŸ“¦ Checking polyfills..."
for file in lib/os-mock.js lib/polyfills/{crypto,buffer,stream,util}-mock.js; do
  if [ -f "$file" ]; then
    echo "âœ… $file"
  else
    echo "âŒ Missing: $file"
    exit 1
  fi
done

# Check next.config.js syntax
echo "âš™ï¸  Validating next.config.js..."
node -c next.config.js && echo "âœ… Syntax valid" || exit 1

# Check if buffer and process are installed
echo "ğŸ“š Checking dependencies..."
npm list buffer process --depth=0 2>/dev/null | grep -E "(buffer|process)" && echo "âœ… Dependencies installed" || echo "âš ï¸  Install: npm install buffer process"

# Test require resolution
echo "ğŸ”— Testing require resolution..."
node -e "try { require('./lib/os-mock.js'); console.log('âœ… os-mock.js loadable'); } catch(e) { console.error('âŒ', e.message); process.exit(1); }"
node -e "try { require('./lib/polyfills/crypto-mock.js'); console.log('âœ… crypto-mock.js loadable'); } catch(e) { console.error('âŒ', e.message); process.exit(1); }"

echo ""
echo "âœ… All checks passed!"
echo "ğŸ’¡ Run 'npm run build' to test full build"
