name: Content Generation

on:
  workflow_dispatch:
    inputs:
      batch_size:
        description: 'Number of products to process'
        required: true
        default: '100'
      concurrency:
        description: 'Number of parallel workers'
        required: true
        default: '10'

jobs:
  generate:
    runs-on: ubuntu-latest
    timeout-minutes: 180

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '20'
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: Generate content
        env:
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
          BATCH_SIZE: ${{ github.event.inputs.batch_size }}
          CONCURRENCY: ${{ github.event.inputs.concurrency }}
        run: npm run content:generate

      - name: Upload generated content
        uses: actions/upload-artifact@v3
        with:
          name: generated-content
          path: generated-content/

      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v5
        with:
          commit-message: 'feat: add generated content'
          title: 'Generated Content - Batch'
          body: |
            ## Content Generation Report

            Generated by GitHub Actions workflow.
          branch: generated-content
